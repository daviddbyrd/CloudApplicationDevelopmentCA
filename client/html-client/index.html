<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product HTML Client</title>
  </head>
  <body onload="loadData()">
    <h2>Product Client</h2>
    <div id="products"></div>

    <script>
      var data = [];
      const loadData = async () => {
        var url = "http://localhost:3000/products";
        var response = await fetch(url, {
          headers: {
            Accept: "application/json",
          },
        });
        data = await response.json();
        data.forEach((product) => {
          product["isEditing"] = false;
          product["temp"] = {};
        });
        render();
      };

      const render = () => {
        const productContainer = document.getElementById("products");

        productContainer.innerHTML = "";

        data.forEach((product) => {
          const productDiv = document.createElement("div");

          if (product.isEditing) {
            productDiv.innerHTML = `
              <b>Name: </b> <input value="${product.temp.name}" onchange="updateTemp(${product.id}, 'name', this.value)"> <br/>
              <b>Description: </b> <input value="${product.temp.description}" onchange="updateTemp(${product.id}, 'description', this.value)"> <br/>
              <b>Price: </b> <input value="${product.temp.price}" onchange="updateTemp(${product.id}, 'price', this.value)"> <br/>
              <b>Available: </b> <input value="${product.temp.available}" onchange="updateTemp(${product.available}, 'available', this.value)" > <br/>
              <input type="button" onclick="saveEdit(${product.id});" value="Save Changes">
              <input type="button" onclick="cancelEdit(${product.id});" value="Cancel Changes">
            `;
          } else {
            productDiv.innerHTML = `
              <b>Name: </b> ${product.name} <br/>
              <b>Description: </b> ${product.description} <br/>
              <b>Price: </b> ${product.price} <br/>
              <b>Available: </b> ${product.available} <br/>
              <input type="button" onclick="editProduct(${product.id});" value="Edit Product">
              <input type="button" onclick="deleteProduct(${product.id});" value="Delete Product">
            `;
          }
          productContainer.appendChild(productDiv);
        });
      };

      const editProduct = (id) => {
        const product = data.find((product) => product.id === id);
        product.temp = {
          name: product.name,
          description: product.description,
          price: product.price,
          available: product.available,
        };
        product.isEditing = true;
        render();
      };

      const updateTemp = (id, attr, val) => {
        const product = data.find((product) => product.id === id);
        product.temp[attr] = val;
        render();
      };

      const cancelEdit = (id) => {
        const product = data.find((product) => product.id === id);
        product.temp = {};
        product.isEditing = false;
        render();
      };

      const saveEdit = async (id) => {
        const product = data.find((product) => product.id === id);
        const updatedProduct = {
          name: product.temp.name,
          description: product.temp.description,
          price: product.temp.price,
          available: product.temp.available,
        };
        var url = `http://localhost:3000/products/${id}`;
        var response = await fetch(url, {
          method: "PUT",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },
          body: JSON.stringify(updatedProduct),
        });
        loadData();
      };

      const deleteProduct = async (id) => {
        var url = `http://localhost:3000/products/${id}`;
        var response = await fetch(url, {
          method: "DELETE",
          headers: {
            Accept: "application/json",
          },
        });
        loadData();
      };
    </script>
  </body>
</html>
